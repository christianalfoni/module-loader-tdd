(function(){var e=typeof module!=="undefined"&&module.exports;var t=e?global:window;var n=[];var r=[];var i=false;var s=e?module.require:null;var o=e?module:null;var u="Templates";var a=[];var f=null;var l=null;var c={Handlebars:typeof Handlebars!=="undefined"?Handlebars:null,Module:function(t,n){this.name=t;this.func=n},isModule:function(e){return e instanceof c.Module},"throw":function(e){throw Error("MODULE-LOADER-TDD(): "+e)},getSinon:function(){return e?require("sinon"):t.sinon},createResourceHandler:function(n){var r={},i=function(e,n){var i=function(e){var r=n.apply(t,e.detail.value);e.detail.result=r||true};r[e]=i;return i};return{register:function(r,s){if(n){return}if(e){l.addListener("resource:"+r,i(r,s))}else{t.addEventListener("resource:"+r,i(r,s))}},fetch:function(n){var r={value:Array.prototype.slice.call(arguments,0).splice(1,arguments.length)},i=e?{detail:r}:new CustomEvent("resource:"+n,{detail:r});e?l.emit("resource:"+n,i):t.dispatchEvent(i);if(typeof r.result==="undefined"){c.throw('Resource Error: "'+n+'" is not a valid resource')}return r.result},remove:function(n){if(r[n]){if(e){l.removeListener("resource:"+n,r[n])}else{t.removeEventListener("resource:"+n,r[n])}delete r[n]}else{c.throw("Resource Error: Can not remove "+n+", it does not exist")}},teardown:function(){for(var n in r){if(e){l.removeListener("resource:"+n,r[n])}else{t.removeEventListener("resource:"+n,r[n])}delete r[n]}}}},getModule:function(t,n){var r;for(var i=0;i<n.length;i++){if(n[i].name===t){r=n[i];break}}if(e&&!r){return c.nodeRequire(t,n)}else if(!r)c.throw('Could not require module: "'+t+'". It might be because the script is not loaded, the name does not exist or you have caused a loop.');return r},addModule:function(e,t,n){e.push(new c.Module(t,n))},registerModules:function(e,t){var n,r,i=true,s=[];while(e.length){i=true;n=c.getLast(e);r=c.createContext(t);try{r.exports=n.func.apply(r,c.contextToArray(r))}catch(o){if(o.message.match(/MODULE-LOADER/)){c.addDepException(s,o.message);c.moveLastToFirst(e);i=false}else{throw o}if(s.length){c.throw("The following "+s[0].type.toUpperCase()+" gave errors: "+s[0].name+". It does not exist "+(s[0].type==="module"?"or has caused a loop.":""))}}if(i&&typeof r.exports==="undefined"){c.throw("Module "+n.name+" is returning undefined, it has to return something")}if(i){n.exports=r.exports;c.moveLastToTarget(e,t)}}},contextToArray:function(e){return[e.require,e.privates,e.resource]},registerTestModule:function(e,t){var n,r,i,s=[];while(!i){n=c.getLast(t);r=c.createTestContext(t);if(n.name===e){try{r.exports=n.func.apply(r,c.contextToArray(r))}catch(o){if(o.message.match(/MODULE-LOADER/)){c.addDepException(s,o.message);c.moveLastToFirst(t)}else{throw o}if(s.length){c.throw("The following "+s[0].type.toUpperCase+" gave errors: "+s[0].name+". It does not exist "+(s[0].type==="module"?"or has caused a loop.":""))}}i=n}else{c.moveLastToFirst(t)}}if(!r.exports&&!s.length){c.throw("Module "+i.name+" is returning undefined, it has to return something")}return r},addDepException:function(e,t){var n=t.match(/\"(.*)\"/)[1],r=t.match(/Resource/)?"resource":"module";if(a.indexOf(n+"_"+r)===-1){a.push(n+"_"+r)}else{e.push({type:r,name:n})}},hasUnregisteredModule:function(e){for(var t=e.length-1;t>=0;t--){if(e[t].name==="__node__"){return e[t]}}},nodeRequire:function(e,t){var u=s.call(o,e);var a=c.hasUnregisteredModule(n);if(a){a.name=e;if(!i){c.registerModules(n,r);return c.getModule(e,t).exports}else{return c.getModule(e,t)}}else{return u}},getModulePath:function(e){if(e.substr(0,1)==="."){var t=s.call(o,"path"),n=s.call(o,"callsite"),r=n(),i=r[2].getFileName();e=t.dirname(i)+e.substr(1)}return e},createContext:function(t){var n={privates:{},require:function(n){if(e){n=c.getModulePath(n)}var r=c.getModule(n,t);return c.isModule(r)?r.exports:r},resource:f};if(!e&&c.Handlebars){n.require.template=c.getTemplate}else if(!e){n.require.template=function(){c.throw("Unable to fetch template. Can not find Handlebars in the global scope, is it loaded? Be sure to load module-loader-tdd after any other libs")}}return n},createTestContext:function(t){var n={privates:{},deps:{},resource:f};n.require=c.createTestRequireMethod(n,t);if(!e){n.require.template=function(){return function(){return""}}}return n},createTestRequireMethod:function(t,n){return function(r){var i=[];if(e){r=c.getModulePath(r)}var s=c.getModule(r,n),o={privates:{},require:function(r){if(e){r=c.getModulePath(r)}var s=c.getModule(r,n);try{s=s.func.apply(t,c.contextToArray(t))}catch(o){if(o.message.match(/MODULE-LOADER/)){c.addDepException(i,o.message)}else{throw o}}return c.isModule(s)?s.exports:s}};if(!e&&c.Handlebars){o.require.template=function(){return function(){return""}}}o.exports=c.isModule(s)?s.func.apply(o,c.contextToArray(o)):s;s.exports=c.stubDepExports(o.exports);t.deps[r]=s.exports;return s.exports}},stubDepExports:function(e){var t=c.getSinon();if(t){var n={};if(typeof e==="function"){return t.spy()}else{for(var r in e){if(typeof e[r]==="function"){n[r]=e[r];t.stub(n,r)}}}return n}return e},getTemplate:function(e){if(!c.Handlebars){return c.throw("Handlebars is not loaded, please load Handlebars before loading module-loader-tdd")}if(t[u]&&t[u][e]){return t[u][e]}else{return c.getTemplateByXhr(e)}},getTemplateByXhr:function(e){var t=new XMLHttpRequest;e=(window.modules.templatesPath||"templates/")+e+".hbs";t.open("GET",e,false);t.send(null);if(t.status===200){return c.Handlebars.compile(t.responseText)}else{c.throw("Could not download requested template at: "+e+" , it probably does not exist, check the name")}},getLast:function(e){return e[e.length-1]},moveLastToFirst:function(e){e.unshift(e.pop())},moveLastToTarget:function(e,t){t.push(e.pop())},extractBrowserArgs:function(e){return{name:e[0],func:e[1]}},extractNodeArgs:function(e){return{name:"__node__",func:e[0]}},parseTemplatesPath:function(e){if(e.substr(0,1)==="/"){e=e.slice(1,e.length)}if(e.substr(e.length-1,1)!=="/"){e+="/"}return e}};var h={_privates:c,create:function(){var t;if(e){t=c.extractNodeArgs(arguments)}else{t=c.extractBrowserArgs(arguments)}if(!t.name||typeof t.name!=="string"||!t.func||typeof t.func!=="function"){c.throw("Invalid arguments for module creation, you have to pass a string and a function, or just a function if running in Node")}c.addModule(n,t.name,t.func)},initialize:function(t){var i=function(){c.registerModules(n,r);var e=c.createContext(r);t.apply(e,c.contextToArray(e))};if(this.templatesPath){this.templatesPath=c.parseTemplatesPath(this.templatesPath)}if(this.templates){u=this.templates}f=c.createResourceHandler();if(e){i()}else{document.addEventListener("DOMContentLoaded",i)}},test:function(t,r){i=true;f=c.createResourceHandler(true);if(e){t=c.getModulePath(t);c.getModule(t,n)}var s=c.registerTestModule(t,n);r.apply(s,[s.exports,s.privates,s.deps,c.createResourceHandler(false)])},reset:function(){r=[];n=[]}};if(e){l=require("events").EventEmitter;l=new l;t.modules=h;module.exports=h}else{t.modules=h}})()